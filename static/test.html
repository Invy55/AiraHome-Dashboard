<iframe id="view_frame" width="100%">
    If you are seeing this it means that your browser does not support Iframes. Please use an updated browser...
</iframe>
<script>
window.addEventListener("load", function() {
    let view_frame = document.getElementById('view_frame');
    //view_frame.addEventListener('load', function() {
        //view_frame.style.height = view_frame.parentElement.offsetHeight - 6 + "px";
        if (!view_frame.src) {
            raw_data = `_measurement: error, active: true,_measurement: heat_pump, allowed_pump_mode_state: PUMP_MODE_STATE_HEATING, away_mode_enabled: false, compressor_has_stopping_alarm: false, configured_pump_modes: PUMP_MODE_STATE_HEATING_COOLING, current_outdoor_temperature: 25.3, hp_has_acknowledgeable_alarms: false, hp_has_some_alarm: true, hp_has_stopping_alarms: false, inline_heater_active: false, led_pattern: LED_PATTERN_NORMAL, manual_mode_enabled: false, night_mode_enabled: true, operating_status: OPERATING_STATUS_USER_SPECIFIC, power_preference: POWER_PREFERENCE_UNSPECIFIED, pump_active_state: PUMP_ACTIVE_STATE_IDLE, signature_element_enabled: true,_measurement: thermostat, actual_temperature: 30.1, article_number: 201884, bootloader_version: 102, current_pump_mode_state: PUMP_MODE_STATE_IDLE, dhw_boost_count: 0, fw_version: 121, humidity: 58.6, reboot_count: 0, rssi: -70, serial_number: 2412090125, setpoint_set_count: 0, wakeup_count: 0, warning_low_battery_level: false, zone_setpoint_cooling: 22, zone_setpoint_heating: 20, zone_temperature: 30.1, actual_temperature: 28.8, article_number: 201884, bootloader_version: 102, current_pump_mode_state: PUMP_MODE_STATE_IDLE, dhw_boost_count: 0, fw_version: 121, humidity: 67.8, reboot_count: 0, rssi: -87, serial_number: 2408191091, setpoint_set_count: 0, wakeup_count: 0, warning_low_battery_level: false, zone_setpoint_cooling: 22, zone_setpoint_heating: 20, zone_temperature: 28.8,_measurement: water_heater, current_hot_water_temperature: 61.6, force_heating_enabled: false, hot_water_heating_enabled: true, target_hot_water_temperature: 50
`.split('_measurement:');
            alert(raw_data);
            data = {};
            raw_data.forEach(function(measurement) {
                temp_data = measurement.split(',');
                if (temp_data.length > 0) {
                    //console.log(temp_data);
                    key = temp_data[0].trim();
                    data[key] = {};
                    temp_data.slice(1).forEach(function(item) {
                        if (!item.includes(':')) {
                            return; // Skip if no colon is found
                        }
                        [cur_key, value] = item.split(':', 2);
                        if (!cur_key || !value) {
                            return; // Skip if either key or value is missing
                        }
                        data[key][cur_key.trim()] = value.trim();
                    });
                }
            });
            alert(encodeURIComponent(JSON.stringify(data)));
            view_frame.src = window.location.protocol + "//" + window.location.hostname + ":4001/?data=" + encodeURIComponent(JSON.stringify(data));
        }
    //});
});
</script>